<!doctype html>
<html lang="en">
  <!-- Default header, with a title. Links to the main stylesheet. -->

  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>The Circular Train</title>
    <link rel="stylesheet" href="/styles/base.css" />
    <script>
      function copyCode(button) {
        const pre = button.parentElement;
        const code = pre.querySelector("code");
        const text = code.innerText;

        navigator.clipboard.writeText(text);

        button.classList.add("copied");
        const originalIcon = button.innerHTML;
        button.innerHTML = `
            <svg class="icon icon--stroke" width="24" height="24">
                <use href="/assets/icons/sprite.svg#check"></use>
            </svg>
        `;

        setTimeout(() => {
          button.classList.remove("copied");
          button.innerHTML = originalIcon;
        }, 1000);
      }
    </script>
  </head>

  <!-- The body: the layout-container div contains all the content -->

  <body>
    <div class="layout-container">
      <!-- Padding on the left -->
      <div class="spacing-left"></div>

      <!-- The sidebar on the left, with the site title and navigation links -->
      <div class="sidebar-left">
        <!-- Header with the site title and a link to the map page -->
        <div class="sidebar-header">
          <a href="/" class="site-title">AK1089's Site</a>
          <a href="/map" class="map-link">
            <svg class="icon icon--stroke">
              <use href="/assets/icons/sprite.svg#map"></use>
            </svg>
          </a>
        </div>

        <!-- Primary navigation bar: links to the main sections of the site -->
        <nav>
          <ul class="nav-list">
            <li class="nav-item">
              <a
                href="/utilities"
                class="nav-link"
                style="border-left: 3px solid var(--blue)"
                >utilities</a
              >
            </li>
            <li class="nav-item">
              <a
                href="/projects"
                class="nav-link"
                style="border-left: 3px solid var(--lime)"
                >projects</a
              >
            </li>
            <li class="nav-item">
              <a
                href="/blog"
                class="nav-link"
                style="border-left: 3px solid var(--peach)"
                >blog</a
              >
            </li>
            <li class="nav-item">
              <a
                href="/puzzles"
                class="nav-link"
                style="border-left: 3px solid var(--purple)"
                >puzzles</a
              >
            </li>
            <li class="nav-item">
              <a
                href="/tech"
                class="nav-link"
                style="border-left: 3px solid var(--maroon)"
                >tech</a
              >
            </li>
            <li class="nav-item">
              <a
                href="/maths"
                class="nav-link"
                style="border-left: 3px solid var(--teal)"
                >maths</a
              >
            </li>
            <li class="nav-item">
              <a
                href="/minr"
                class="nav-link"
                style="border-left: 3px solid var(--yellow)"
                >minr</a
              >
            </li>
            <li class="nav-item">
              <a
                href="/other"
                class="nav-link"
                style="border-left: 3px solid var(--subtext-b)"
                >other</a
              >
            </li>
          </ul>
        </nav>

        <div class="social-icons">
          <a
            href="https://x.com/_AK1089_"
            target="_blank"
            class="icon social-icon"
          >
            <svg viewBox="0 0 24 24">
              <use href="/assets/icons/sprite.svg#twitter"></use>
            </svg>
          </a>
          <a
            href="https://github.com/ak1089/"
            target="_blank"
            class="icon social-icon"
          >
            <svg viewBox="0 0 24 24">
              <use href="/assets/icons/sprite.svg#github"></use>
            </svg>
          </a>
          <a
            href="https://discord.com/users/380805820415344644"
            target="_blank"
            class="icon social-icon"
          >
            <svg viewBox="0 0 24 24">
              <use href="/assets/icons/sprite.svg#discord"></use>
            </svg>
          </a>
          <a
            href="https://steamcommunity.com/profiles/76561198281258106/"
            target="_blank"
            class="icon social-icon"
          >
            <svg viewBox="0 0 24 24">
              <use href="/assets/icons/sprite.svg#steam"></use>
            </svg>
          </a>
          <a
            href="https://www.last.fm/user/AK1089-"
            target="_blank"
            class="icon social-icon"
          >
            <svg viewBox="0 0 24 24">
              <use href="/assets/icons/sprite.svg#lastfm"></use>
            </svg>
          </a>
          <a
            href="https://www.linkedin.com/in/avishkumar/"
            target="_blank"
            class="icon social-icon"
          >
            <svg viewBox="0 0 24 24">
              <use href="/assets/icons/sprite.svg#linkedin"></use>
            </svg>
          </a>
        </div>
      </div>

      <!-- Spacing between the sidebar and the main content -->
      <div class="spacing-middle-left"></div>

      <!-- The main content of the page: this is changed per-page and contains the actual content -->
      <main class="main-content">
        <header class="page-header">
          <div class="header-container">
            <div class="path">
              <a href="/" class="path-link">home</a>
              <span class="separator"> / </span
              ><a href="/puzzles" class="path-link">puzzles</a
              ><span class="separator"> / </span
              ><a href="/puzzles/circular-train" class="path-link"
                >circular-train</a
              >
            </div>
            <h1 class="title">The Circular Train</h1>
            <div class="metadata">
              <span class="published-date">published January 08, 2025</span>
            </div>
          </div>
        </header>
        <link
          rel="stylesheet"
          href="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.css"
          integrity="sha384-R4558gYOUz8mP9YWpZJjofhk+zx0AS11p36HnD2ZKj/6JR5z27gSSULCNHIRReVs"
          crossorigin="anonymous"
        />

        <style type="text/css">
          .katex img {
            object-fit: fill;
            padding: unset;
            display: block;
            position: absolute;
            width: 100%;
            height: inherit;
          }
        </style>
        <h2>Puzzle</h2>
        <p>
          You are on a train with some finite but unknown number of perfectly
          identical carriages. Each carriage has a light, which is either on or
          off, and a switch allowing you to toggle the state of the lights. At
          the start, all the lights are in some random (and possibly
          adversarial) configuration.
        </p>
        <p>
          You may explore the train and use the switches freely, but you cannot
          make any other marks. How do you determine <em>with certainty</em> the
          total number of carriages in the train?
        </p>
        <figure>
          <img
            alt="A diagram explaining your situation. The start carriage is highlighted, but in reality it looks no different from any other carriage."
            src="explanation.png"
          />
          <figcaption>
            A diagram explaining your situation. The start carriage is
            highlighted, but in reality it looks no different from any other
            carriage.
          </figcaption>
        </figure>
        <h2>Common Wrong Answers and Hints</h2>
        <p>
          This problem is not as simple as it seems. For example,
          <span class="spoiler"
            ><span
              >any solution along the lines of &ldquo;&hellip;and when you get
              back to the start carriage, you can&hellip;&rdquo; is destined to
              fail. You do not generally know when you&rsquo;ve gotten back to
              the start!</span
            ></span
          >
        </p>
        <p>
          Another common pitfall is deciding to
          <span class="spoiler"
            ><span
              >&ldquo;go around until you find&hellip;&rdquo; when the train
              could stretch on for billions of carriages, all of which could
              have their lights on!</span
            ></span
          >
          For example, one strategy frequently suggested is to
          <span class="spoiler"
            ><span
              >create a pattern and find it again by walking around the train.
              However, it is impossible to guarantee that you have seen the same
              pattern, as it may have occurred naturally.</span
            ></span
          >
        </p>
        <p>
          More generally, most solutions are vulnerable to adversarial starting
          configurations. Can you think of a
          <span class="spoiler"
            ><span
              >starting arrangement of lights that would make your strategy
              fail?</span
            ></span
          >
          Would your strategy still work even if
          <span class="spoiler"
            ><span>there were a trillion carriages?</span></span
          >
        </p>
        <p>
          Here are some hints: don&rsquo;t hover over these until you&rsquo;ve
          given the problem a go yourself.
        </p>
        <ol>
          <li>
            <span class="spoiler"
              ><span
                >You need to recognise when you&rsquo;ve been in the same
                carriage twice on different laps of the train.</span
              ></span
            >
          </li>
          <li>
            <span class="spoiler"
              ><span
                >No matter how far forwards you go, you can&rsquo;t be sure
                you&rsquo;ve returned to the start. Why?</span
              ></span
            >
          </li>
          <li>
            <span class="spoiler"
              ><span
                >This means you need to go <em>backwards</em> as well as
                forwards around the train.</span
              ></span
            >
          </li>
          <li>
            <span class="spoiler"
              ><span
                >Suppose the train had more than one carriage. How would you
                prove this? If this were not true, how would this proof
                fail?</span
              ></span
            >
          </li>
          <li>
            <span class="spoiler"
              ><span
                >If you prove this, can you prove that there are more than
                <em>two</em> carriages? Three?</span
              ></span
            >
          </li>
          <li>
            <span class="spoiler"
              ><span
                >If you change the light in one carriage, and it changes the
                light in the carriage 5 doors down&hellip;</span
              ></span
            >
          </li>
        </ol>
        <h2>Solution</h2>
        <blockquote class="quote-warning">
          <svg
            class="icon icon--stroke"
            style="stroke-width: 2"
            width="24"
            height="24"
          >
            <use href="/assets/icons/sprite.svg#warning"></use>
          </svg>
          Do not read past this point unless you think you have a solution!
        </blockquote>
        <p>
          The solution takes the form of first supposing that the train has one
          carriage and attempting to disprove that hypothesis, then supposing
          that the train has two carriages and attempting to disprove that
          hypothesis, and so on. Eventually, we will fail to disprove one of
          these hypotheses, because it will be true.
        </p>
        <p>
          Suppose we think the train might only have one carriage, and want to
          check this. Right now, we are in the start carriage <code>c0</code>.
          We turn the light <span style="color: var(--yellow)">on</span>, and go
          forward one carriage to <code>c1</code>.
        </p>
        <p>
          If the light in <code>c1</code> is
          <span style="color: var(--darkblue)">off</span>, then clearly
          <code>c0</code> and <code>c1</code> are different carriages, since
          their lights are in different states. Hypothesis disproven! Move back
          to <code>c0</code> and continue with the next hypothesis.
        </p>
        <p>
          If the light in <code>c1</code> is
          <span style="color: var(--yellow)">on</span>, then switch it
          <span style="color: var(--darkblue)">off</span>. Now, we go
          <em>back</em> to <code>c0</code>. If the light here has mysteriously
          switched <span style="color: var(--darkblue)">off</span>, then clearly
          <code>c1</code> is the same as <code>c0</code>, since the light switch
          in <code>c1</code> affected the light in <code>c0</code>! We can thus
          conclude that there is one carriage. Otherwise, we have disproven the
          hypothesis, and can return to <code>c0</code>.
        </p>
        <p>
          Now, we repeat this procedure, conjecturing that there are
          <span class="katex"
            ><span class="katex-mathml"
              ><math xmlns="http://www.w3.org/1998/Math/MathML"
                ><semantics
                  ><mrow><mi>n</mi></mrow
                  ><annotation encoding="application/x-tex"
                    >n</annotation
                  ></semantics
                ></math
              ></span
            ><span class="katex-html" aria-hidden="true"
              ><span class="base"
                ><span class="strut" style="height: 0.4306em"></span
                ><span class="mord mathnormal">n</span></span
              ></span
            ></span
          >
          carriages:
        </p>
        <ol>
          <li>
            Turn the light in <code>c0</code>
            <span style="color: var(--yellow)">on</span>.
          </li>
          <li>
            Go
            <span class="katex"
              ><span class="katex-mathml"
                ><math xmlns="http://www.w3.org/1998/Math/MathML"
                  ><semantics
                    ><mrow><mi>n</mi></mrow
                    ><annotation encoding="application/x-tex"
                      >n</annotation
                    ></semantics
                  ></math
                ></span
              ><span class="katex-html" aria-hidden="true"
                ><span class="base"
                  ><span class="strut" style="height: 0.4306em"></span
                  ><span class="mord mathnormal">n</span></span
                ></span
              ></span
            >
            steps forward to <code>cn</code>.
          </li>
          <li>
            If the light in <code>cn</code> is
            <span style="color: var(--darkblue)">off</span>, then go back to
            <code>c0</code>, and return to step 1, setting
            <span class="katex"
              ><span class="katex-mathml"
                ><math xmlns="http://www.w3.org/1998/Math/MathML"
                  ><semantics
                    ><mrow
                      ><mi>n</mi><mo>=</mo><mi>n</mi><mo>+</mo><mn>1</mn></mrow
                    ><annotation encoding="application/x-tex"
                      >n = n+1</annotation
                    ></semantics
                  ></math
                ></span
              ><span class="katex-html" aria-hidden="true"
                ><span class="base"
                  ><span class="strut" style="height: 0.4306em"></span
                  ><span class="mord mathnormal">n</span
                  ><span class="mspace" style="margin-right: 0.2778em"></span
                  ><span class="mrel">=</span
                  ><span
                    class="mspace"
                    style="margin-right: 0.2778em"
                  ></span></span
                ><span class="base"
                  ><span
                    class="strut"
                    style="height: 0.6667em; vertical-align: -0.0833em"
                  ></span
                  ><span class="mord mathnormal">n</span
                  ><span class="mspace" style="margin-right: 0.2222em"></span
                  ><span class="mbin">+</span
                  ><span
                    class="mspace"
                    style="margin-right: 0.2222em"
                  ></span></span
                ><span class="base"
                  ><span class="strut" style="height: 0.6444em"></span
                  ><span class="mord">1</span></span
                ></span
              ></span
            >.
          </li>
          <li>
            If the light in <code>cn</code> is
            <span style="color: var(--yellow)">on</span>, turn it
            <span style="color: var(--darkblue)">off</span> and go back to
            <code>c0</code>.
          </li>
          <li>
            If the light in <code>c0</code> is
            <span style="color: var(--darkblue)">off</span>, then there are
            precisely
            <span class="katex"
              ><span class="katex-mathml"
                ><math xmlns="http://www.w3.org/1998/Math/MathML"
                  ><semantics
                    ><mrow><mi>n</mi></mrow
                    ><annotation encoding="application/x-tex"
                      >n</annotation
                    ></semantics
                  ></math
                ></span
              ><span class="katex-html" aria-hidden="true"
                ><span class="base"
                  ><span class="strut" style="height: 0.4306em"></span
                  ><span class="mord mathnormal">n</span></span
                ></span
              ></span
            >
            carriages!
          </li>
          <li>
            If the ligth in <code>c0</code> is
            <span style="color: var(--yellow)">on</span>, then return to step 1,
            setting
            <span class="katex"
              ><span class="katex-mathml"
                ><math xmlns="http://www.w3.org/1998/Math/MathML"
                  ><semantics
                    ><mrow
                      ><mi>n</mi><mo>=</mo><mi>n</mi><mo>+</mo><mn>1</mn></mrow
                    ><annotation encoding="application/x-tex"
                      >n = n+1</annotation
                    ></semantics
                  ></math
                ></span
              ><span class="katex-html" aria-hidden="true"
                ><span class="base"
                  ><span class="strut" style="height: 0.4306em"></span
                  ><span class="mord mathnormal">n</span
                  ><span class="mspace" style="margin-right: 0.2778em"></span
                  ><span class="mrel">=</span
                  ><span
                    class="mspace"
                    style="margin-right: 0.2778em"
                  ></span></span
                ><span class="base"
                  ><span
                    class="strut"
                    style="height: 0.6667em; vertical-align: -0.0833em"
                  ></span
                  ><span class="mord mathnormal">n</span
                  ><span class="mspace" style="margin-right: 0.2222em"></span
                  ><span class="mbin">+</span
                  ><span
                    class="mspace"
                    style="margin-right: 0.2222em"
                  ></span></span
                ><span class="base"
                  ><span class="strut" style="height: 0.6444em"></span
                  ><span class="mord">1</span></span
                ></span
              ></span
            >.
          </li>
        </ol>
        <p>
          This always terminates on iteration
          <span class="katex"
            ><span class="katex-mathml"
              ><math xmlns="http://www.w3.org/1998/Math/MathML"
                ><semantics
                  ><mrow><mi>n</mi></mrow
                  ><annotation encoding="application/x-tex"
                    >n</annotation
                  ></semantics
                ></math
              ></span
            ><span class="katex-html" aria-hidden="true"
              ><span class="base"
                ><span class="strut" style="height: 0.4306em"></span
                ><span class="mord mathnormal">n</span></span
              ></span
            ></span
          >, where
          <span class="katex"
            ><span class="katex-mathml"
              ><math xmlns="http://www.w3.org/1998/Math/MathML"
                ><semantics
                  ><mrow><mi>n</mi></mrow
                  ><annotation encoding="application/x-tex"
                    >n</annotation
                  ></semantics
                ></math
              ></span
            ><span class="katex-html" aria-hidden="true"
              ><span class="base"
                ><span class="strut" style="height: 0.4306em"></span
                ><span class="mord mathnormal">n</span></span
              ></span
            ></span
          >
          is the number of carriages. Iteration
          <span class="katex"
            ><span class="katex-mathml"
              ><math xmlns="http://www.w3.org/1998/Math/MathML"
                ><semantics
                  ><mrow><mi>i</mi></mrow
                  ><annotation encoding="application/x-tex"
                    >i</annotation
                  ></semantics
                ></math
              ></span
            ><span class="katex-html" aria-hidden="true"
              ><span class="base"
                ><span class="strut" style="height: 0.6595em"></span
                ><span class="mord mathnormal">i</span></span
              ></span
            ></span
          >
          of the algorithm takes at most
          <span class="katex"
            ><span class="katex-mathml"
              ><math xmlns="http://www.w3.org/1998/Math/MathML"
                ><semantics
                  ><mrow><mn>2</mn><mi>i</mi></mrow
                  ><annotation encoding="application/x-tex"
                    >2i</annotation
                  ></semantics
                ></math
              ></span
            ><span class="katex-html" aria-hidden="true"
              ><span class="base"
                ><span class="strut" style="height: 0.6595em"></span
                ><span class="mord">2</span
                ><span class="mord mathnormal">i</span></span
              ></span
            ></span
          >
          steps, so this procedure will always find the correct number within
          <span class="katex"
            ><span class="katex-mathml"
              ><math xmlns="http://www.w3.org/1998/Math/MathML"
                ><semantics
                  ><mrow
                    ><msup><mi>n</mi><mn>2</mn></msup
                    ><mo>+</mo><mi>n</mi></mrow
                  ><annotation encoding="application/x-tex"
                    >n^2 + n</annotation
                  ></semantics
                ></math
              ></span
            ><span class="katex-html" aria-hidden="true"
              ><span class="base"
                ><span
                  class="strut"
                  style="height: 0.8974em; vertical-align: -0.0833em"
                ></span
                ><span class="mord"
                  ><span class="mord mathnormal">n</span
                  ><span class="msupsub"
                    ><span class="vlist-t"
                      ><span class="vlist-r"
                        ><span class="vlist" style="height: 0.8141em"
                          ><span style="top: -3.063em; margin-right: 0.05em"
                            ><span class="pstrut" style="height: 2.7em"></span
                            ><span class="sizing reset-size6 size3 mtight"
                              ><span class="mord mtight">2</span></span
                            ></span
                          ></span
                        ></span
                      ></span
                    ></span
                  ></span
                ><span class="mspace" style="margin-right: 0.2222em"></span
                ><span class="mbin">+</span
                ><span
                  class="mspace"
                  style="margin-right: 0.2222em"
                ></span></span
              ><span class="base"
                ><span class="strut" style="height: 0.4306em"></span
                ><span class="mord mathnormal">n</span></span
              ></span
            ></span
          >
          moves!
        </p>
      </main>

      <!-- Spacing between the sidebar and the main content -->
      <div class="spacing-middle-right"></div>

      <!-- The sidebar on the right -->
      <aside class="sidebar-right"></aside>

      <!-- Padding on the right -->
      <div class="spacing-right"></div>
    </div>

    <!-- Load the map script -->
    <script>
      // Load visited URLs from localStorage
      let visitedUrls = new Set();
      const storedVisited = localStorage.getItem("visitedPages");
      if (storedVisited) {
        visitedUrls = new Set(JSON.parse(storedVisited));
      }

      // Log current page visit
      const currentPath = window.location.pathname.replace(/\/$/, "");
      visitedUrls.add(currentPath);
      localStorage.setItem(
        "visitedPages",
        JSON.stringify(Array.from(visitedUrls)),
      );
    </script>
  </body>
</html>
